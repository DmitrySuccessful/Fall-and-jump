<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doodle Jump Clone</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #1a1a1a, #4a4a4a);
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #gameContainer {
            position: relative;
            width: 400px;
            height: 600px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }

        #gameCanvas {
            background: #E0F7FA;
            border-radius: 10px;
            display: block;
            touch-action: none;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            font-size: 14px;
            opacity: 0.8;
            z-index: 150;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
            transition: opacity 0.5s ease;
        }

        .hidden {
            opacity: 0;
        }

        /* Touch Controls */
        .touch-zone {
            position: absolute;
            top: 0;
            height: 100%;
            width: 50%;
            opacity: 0.2;
            z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            touch-action: none;
        }

        #leftTouch {
            left: 0;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        #rightTouch {
            right: 0;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (min-width: 769px) {
            .touch-zone {
                display: none;
            }
        }

        /* Start Screen */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        #gameTitle {
            color: white;
            font-size: 36px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-button {
            padding: 15px 40px;
            font-size: 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            outline: none;
        }

        .game-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .game-button:active {
            transform: translateY(0);
        }

        /* Restart Button */
        #restartBtn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, 50px);
            display: none;
            z-index: 300;
        }

        /* Shop Button */
        #shopBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            font-size: 16px;
            background: #9C27B0;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #shopBtn.locked::after {
            content: "üîí";
            margin-left: 5px;
        }

        /* Coin counter */
        #coinCounter {
            position: absolute;
            top: 10px;
            right: 80px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 16px;
            z-index: 100;
            display: flex;
            align-items: center;
        }

        #coinCounter::before {
            content: "ü™ô";
            margin-right: 5px;
        }

        @media (max-width: 768px) {
            body {
                background: #1a1a1a;
            }

            #gameContainer {
                width: 100%;
                height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }

            #gameCanvas {
                border-radius: 0;
            }

            .instructions {
                bottom: 40px;
                font-size: 16px;
            }

            #gameTitle {
                font-size: 28px;
            }

            .game-button {
                font-size: 20px;
                padding: 12px 30px;
            }
            
            /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ */
            .shop-content {
                width: 90%;
                max-height: 90%;
            }
            
            .shop-items {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .shop-item {
                padding: 8px;
            }
            
            .shop-item-image {
                width: 50px;
                height: 50px;
            }
            
            .shop-button {
                padding: 12px 15px;
                font-size: 18px;
            }
            
            /* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ z-index –º–∞–≥–∞–∑–∏–Ω–∞ –≤—ã—à–µ, —á–µ–º —É –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            #shopModal {
                z-index: 1000;
            }
        }

        /* Shop Modal */
        #shopModal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }

        .shop-content {
            background: #2a2a2a;
            border-radius: 15px;
            padding: 20px;
            width: 80%;
            max-width: 350px;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .shop-title {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .shop-item {
            background: #3a3a3a;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .shop-item:hover {
            transform: translateY(-5px);
        }

        .shop-item.selected {
            border-color: #4CAF50;
        }

        .shop-item.owned {
            border-color: #2196F3;
        }

        .shop-item-image {
            width: 60px;
            height: 60px;
            background: #4a4a4a;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }

        .shop-item-name {
            color: white;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
        }

        .shop-item-price {
            color: #FFD700;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .shop-item-price::before {
            content: "ü™ô";
            margin-right: 5px;
        }

        .shop-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .shop-button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .shop-button.buy {
            background: #4CAF50;
            color: white;
        }

        .shop-button.buy:disabled {
            background: #7e7e7e;
            cursor: not-allowed;
        }

        .shop-button.close {
            background: #f44336;
            color: white;
        }

        .shop-message {
            color: white;
            font-size: 16px;
            margin-top: 10px;
            text-align: center;
            min-height: 20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="startScreen">
            <h1 id="gameTitle">Doodle Jump</h1>
            <button id="startBtn" class="game-button">Start Game</button>
        </div>
        <button id="restartBtn" class="game-button">Restart Game</button>
        <div id="coinCounter">0</div>
        <button id="shopBtn" class="locked">Shop</button>
        <div id="leftTouch" class="touch-zone"></div>
        <div id="rightTouch" class="touch-zone"></div>
    </div>
    <div class="instructions" id="gameInstructions">
        Use ‚Üê ‚Üí arrows to move<br>
        Jump on platforms to climb higher!<br>
        <span id="mobileInstructions">On mobile, touch left/right side to move</span>
    </div>

    <!-- Shop Modal -->
    <div id="shopModal">
        <div class="shop-content">
            <h2 class="shop-title">Shop</h2>
            <div class="shop-items">
                <!-- Items will be added dynamically -->
            </div>
            <div class="shop-message" id="shopMessage"></div>
            <div class="shop-buttons">
                <button class="shop-button buy" id="buyButton">Buy</button>
                <button class="shop-button close" id="closeShopButton">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Particle System
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = Math.random() * 3 + 2;
                this.speedX = Math.random() * 6 - 3;
                this.speedY = Math.random() * 6 - 3;
                this.life = 1.0;
                this.decay = Math.random() * 0.02 + 0.02;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.speedY += 0.1;
                this.life -= this.decay;
                return this.life > 0;
            }

            draw(ctx) {
                ctx.fillStyle = `rgba(${this.color}, ${this.life})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class ParticleSystem {
            constructor() {
                this.particles = [];
            }

            createJumpEffect(x, y) {
                const colors = [
                    '255, 255, 255',
                    '255, 223, 186',
                    '255, 190, 118'
                ];

                for (let i = 0; i < 15; i++) {
                    this.particles.push(
                        new Particle(
                            x + Math.random() * 40,
                            y + Math.random() * 10,
                            colors[Math.floor(Math.random() * colors.length)]
                        )
                    );
                }
            }

            createCoinEffect(x, y) {
                const colors = [
                    '255, 215, 0',
                    '255, 223, 0',
                    '255, 200, 0'
                ];

                for (let i = 0; i < 10; i++) {
                    this.particles.push(
                        new Particle(
                            x + Math.random() * 20,
                            y + Math.random() * 20,
                            colors[Math.floor(Math.random() * colors.length)]
                        )
                    );
                }
            }

            update() {
                this.particles = this.particles.filter(particle => particle.update());
            }

            draw(ctx) {
                this.particles.forEach(particle => particle.draw(ctx));
            }
        }

        // Coin class
        class Coin {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.collected = false;
                this.rotation = 0;
            }

            update() {
                this.rotation += 0.05;
            }

            draw(ctx) {
                if (this.collected) return;
                
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                ctx.rotate(this.rotation);
                
                // Draw coin
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw highlight
                ctx.fillStyle = '#FFF8E1';
                ctx.beginPath();
                ctx.ellipse(-3, -3, 3, 3, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }

        // Power-up class
        class PowerUp {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.width = 30;
                this.height = 30;
                this.type = type;
                this.collected = false;
            }

            draw(ctx) {
                if (this.collected) return;
                ctx.fillStyle = this.type === 'spring' ? '#FF4081' : '#FFC107';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.fillStyle = '#fff';
                ctx.font = '20px Arial';
                ctx.fillText(this.type === 'spring' ? '‚Üë' : '‚òÖ', this.x + 8, this.y + 22);
            }
        }

        // Player class
        class Player {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 40;
                this.height = 40;
                this.velocityX = 0;
                this.velocityY = 0;
                this.isJumping = false;
                this.powerUpTimer = 0;
                this.hasPowerUp = false;
                this.skin = localStorage.getItem('doodleJumpSkin') || 'default';
            }

            update(canvasWidth) {
                this.velocityY += 0.5;
                this.x += this.velocityX;
                this.y += this.velocityY;

                if (this.x + this.width < 0) {
                    this.x = canvasWidth;
                } else if (this.x > canvasWidth) {
                    this.x = -this.width;
                }

                if (this.powerUpTimer > 0) {
                    this.powerUpTimer--;
                    if (this.powerUpTimer === 0) {
                        this.hasPowerUp = false;
                    }
                }
            }

            draw(ctx) {
                // Draw player body
                ctx.fillStyle = this.hasPowerUp ? '#FFD700' : '#4CAF50';
                ctx.fillRect(this.x, this.y, this.width, this.height);

                // Draw face
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(this.x + 15, this.y + 15, 3, 0, Math.PI * 2);
                ctx.arc(this.x + 25, this.y + 15, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(this.x + 20, this.y + 25, 5, 0, Math.PI);
                ctx.stroke();
                
                // Draw skin based on selected skin
                switch(this.skin) {
                    case 'hat':
                        this.drawHat(ctx);
                        break;
                    case 'glasses':
                        this.drawGlasses(ctx);
                        break;
                    case 'cap-chain':
                        this.drawCapAndChain(ctx);
                        break;
                }
            }
            
            drawHat(ctx) {
                // Draw a simple hat
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(this.x + 5, this.y - 10, 30, 10);
                ctx.fillRect(this.x + 10, this.y - 20, 20, 10);
            }
            
            drawGlasses(ctx) {
                // Draw glasses
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x + 15, this.y + 15, 5, 0, Math.PI * 2);
                ctx.arc(this.x + 25, this.y + 15, 5, 0, Math.PI * 2);
                ctx.stroke();
                
                // Bridge of glasses
                ctx.beginPath();
                ctx.moveTo(this.x + 20, this.y + 15);
                ctx.lineTo(this.x + 20, this.y + 15);
                ctx.stroke();
            }
            
            drawCapAndChain(ctx) {
                // Draw cap
                ctx.fillStyle = '#1E88E5';
                ctx.beginPath();
                ctx.arc(this.x + 20, this.y + 5, 15, Math.PI, 0, false);
                ctx.fill();
                
                // Draw cap visor
                ctx.fillStyle = '#0D47A1';
                ctx.fillRect(this.x + 5, this.y + 5, 30, 5);
                
                // Draw chain
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.x + 5, this.y + 30);
                ctx.lineTo(this.x + 35, this.y + 30);
                ctx.stroke();
            }

            jump(force = -12) {
                this.velocityY = force;
                this.isJumping = true;
            }

            activatePowerUp(type) {
                this.hasPowerUp = true;
                this.powerUpTimer = 300;
                if (type === 'spring') {
                    this.jump(-18);
                }
            }
            
            setSkin(skin) {
                this.skin = skin;
                localStorage.setItem('doodleJumpSkin', skin);
            }
        }

        // Platform class
        class Platform {
            constructor(x, y, type = 'normal') {
                this.x = x;
                this.y = y;
                this.width = 80;
                this.height = 15;
                this.type = type;
                this.broken = false;
                this.direction = 1;
                this.speed = type === 'moving' ? 2 : 0;
                
                // Add power-up with 10% chance
                if (Math.random() < 0.1) {
                    this.powerUp = new PowerUp(
                        this.x + this.width / 2 - 15,
                        this.y - 35,
                        Math.random() < 0.5 ? 'spring' : 'star'
                    );
                }
                
                // Add coin with 25% chance (but not if there's already a power-up)
                if (!this.powerUp && Math.random() < 0.25) {
                    this.coin = new Coin(
                        this.x + this.width / 2 - 10,
                        this.y - 30
                    );
                }
            }

            update(canvasWidth) {
                if (this.type === 'moving') {
                    this.x += this.speed * this.direction;
                    if (this.x <= 0 || this.x + this.width >= canvasWidth) {
                        this.direction *= -1;
                    }
                    
                    if (this.powerUp && !this.powerUp.collected) {
                        this.powerUp.x = this.x + this.width / 2 - 15;
                    }
                    
                    if (this.coin && !this.coin.collected) {
                        this.coin.x = this.x + this.width / 2 - 10;
                        this.coin.update();
                    }
                } else if (this.coin && !this.coin.collected) {
                    this.coin.update();
                }
            }

            draw(ctx) {
                if (this.broken) return;
                
                switch(this.type) {
                    case 'normal':
                        ctx.fillStyle = '#795548';
                        break;
                    case 'moving':
                        ctx.fillStyle = '#2196F3';
                        break;
                    case 'breakable':
                        ctx.fillStyle = '#FF5722';
                        break;
                }
                ctx.fillRect(this.x, this.y, this.width, this.height);

                if (this.powerUp && !this.powerUp.collected) {
                    this.powerUp.draw(ctx);
                }
                
                if (this.coin && !this.coin.collected) {
                    this.coin.draw(ctx);
                }
            }
        }

        // Game class
        class Game {
            constructor(canvas, ctx) {
                this.canvas = canvas;
                this.ctx = ctx;
                this.score = 0;
                this.highScore = parseInt(localStorage.getItem('doodleJumpHighScore')) || 0;
                this.coins = parseInt(localStorage.getItem('doodleJumpCoins')) || 0;
                this.gameOver = false;
                this.platforms = [];
                this.particles = new ParticleSystem();
                this.difficulty = 1;
                this.cameraY = 0;
                this.instructionsHidden = false;
                this.shopUnlocked = true; // Always unlocked for testing
                this.ownedSkins = JSON.parse(localStorage.getItem('doodleJumpOwnedSkins')) || ['default'];
                this.shopItems = [
                    { id: 'hat', name: 'Hat', price: 10, emoji: 'üé©' },
                    { id: 'glasses', name: 'Glasses', price: 20, emoji: 'üëì' },
                    { id: 'cap-chain', name: 'Cap & Chain', price: 30, emoji: 'üß¢' }
                ];
                this.updateShopButton();
            }

            init() {
                const canvasWidth = this.canvas.width;
                const canvasHeight = this.canvas.height;
                
                this.player = new Player(canvasWidth / 2, canvasHeight - 100);
                this.platforms = [];
                this.score = 0;
                this.gameOver = false;
                this.cameraY = 0;
                this.difficulty = 1;
                this.instructionsHidden = false;
                this.updateCoinCounter();
                this.updateShopButton();
                this.initShop();

                // Create initial platforms
                // First platform is directly under the player to prevent falling through
                this.platforms.push(new Platform(canvasWidth / 2 - 40, canvasHeight - 50, 'normal'));
                
                for (let i = 1; i < 7; i++) {
                    this.generatePlatform(canvasHeight - i * 100);
                }
            }

            generatePlatform(y) {
                const types = ['normal', 'moving', 'breakable'];
                const type = Math.random() < 0.7 ? 'normal' : types[Math.floor(Math.random() * types.length)];
                const x = Math.random() * (this.canvas.width - 80);
                this.platforms.push(new Platform(x, y, type));
            }

            update() {
                if (this.gameOver) return;

                const canvasWidth = this.canvas.width;
                const canvasHeight = this.canvas.height;

                this.player.update(canvasWidth);
                this.particles.update();

                // Update difficulty
                this.difficulty = 1 + Math.floor(this.score / 1000);

                // Camera follow
                if (this.player.y < canvasHeight / 2) {
                    const diff = canvasHeight / 2 - this.player.y;
                    this.cameraY += diff;
                    this.player.y += diff;
                    
                    this.platforms.forEach(platform => {
                        platform.y += diff;
                        if (platform.powerUp) {
                            platform.powerUp.y += diff;
                        }
                        if (platform.coin) {
                            platform.coin.y += diff;
                        }
                    });

                    // Remove platforms that are off screen
                    this.platforms = this.platforms.filter(platform => platform.y < canvasHeight);

                    // Generate new platforms
                    while (this.platforms.length < 7) {
                        this.generatePlatform(this.platforms[this.platforms.length - 1].y - 100);
                    }

                    this.score = Math.floor(this.cameraY / 100);
                }

                // Update platforms and check collisions
                this.platforms.forEach(platform => {
                    platform.update(canvasWidth);
                    
                    // Power-up collision
                    if (platform.powerUp && !platform.powerUp.collected &&
                        this.player.x + this.player.width > platform.powerUp.x &&
                        this.player.x < platform.powerUp.x + platform.powerUp.width &&
                        this.player.y + this.player.height > platform.powerUp.y &&
                        this.player.y < platform.powerUp.y + platform.powerUp.height) {
                        platform.powerUp.collected = true;
                        this.player.activatePowerUp(platform.powerUp.type);
                    }
                    
                    // Coin collision
                    if (platform.coin && !platform.coin.collected &&
                        this.player.x + this.player.width > platform.coin.x &&
                        this.player.x < platform.coin.x + platform.coin.width &&
                        this.player.y + this.player.height > platform.coin.y &&
                        this.player.y < platform.coin.y + platform.coin.height) {
                        platform.coin.collected = true;
                        this.coins++;
                        localStorage.setItem('doodleJumpCoins', this.coins);
                        this.updateCoinCounter();
                        this.particles.createCoinEffect(platform.coin.x, platform.coin.y);
                        
                        // Check if shop should be unlocked
                        if (this.coins >= 50 && !this.shopUnlocked) {
                            this.shopUnlocked = true;
                            this.updateShopButton();
                        }
                    }
                    
                    // Platform collision
                    if (!platform.broken && this.player.velocityY > 0 && 
                        this.player.x + this.player.width > platform.x &&
                        this.player.x < platform.x + platform.width &&
                        this.player.y + this.player.height > platform.y &&
                        this.player.y + this.player.height < platform.y + platform.height + 10) {
                        
                        if (platform.type === 'breakable') {
                            platform.broken = true;
                        }
                        this.player.jump();
                        this.particles.createJumpEffect(this.player.x, this.player.y + this.player.height);
                    }
                });

                // Check game over
                if (this.player.y > canvasHeight) {
                    this.gameOver = true;
                    if (this.score > this.highScore) {
                        this.highScore = this.score;
                        localStorage.setItem('doodleJumpHighScore', this.highScore);
                    }
                    document.getElementById('restartBtn').style.display = 'block';
                }
            }

            draw() {
                const canvasWidth = this.canvas.width;
                const canvasHeight = this.canvas.height;

                // Clear canvas
                this.ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                this.ctx.fillStyle = '#E0F7FA';
                this.ctx.fillRect(0, 0, canvasWidth, canvasHeight);

                // Draw game elements
                this.platforms.forEach(platform => platform.draw(this.ctx));
                this.particles.draw(this.ctx);
                this.player.draw(this.ctx);

                // Draw UI
                this.ctx.fillStyle = '#000';
                this.ctx.font = '20px Arial';
                this.ctx.fillText(`Score: ${this.score}`, 10, 30);
                this.ctx.fillText(`High Score: ${this.highScore}`, 10, 60);

                // Draw game over screen
                if (this.gameOver) {
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    this.ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                    this.ctx.fillStyle = '#fff';
                    this.ctx.font = '40px Arial';
                    this.ctx.fillText('Game Over!', canvasWidth/2 - 100, canvasHeight/2 - 40);
                    this.ctx.font = '20px Arial';
                    this.ctx.fillText(`Final Score: ${this.score}`, canvasWidth/2 - 60, canvasHeight/2);
                    this.ctx.fillText(`Coins: ${this.coins}`, canvasWidth/2 - 40, canvasHeight/2 + 30);
                }
            }
            
            hideInstructions() {
                if (!this.instructionsHidden) {
                    document.getElementById('gameInstructions').classList.add('hidden');
                    this.instructionsHidden = true;
                }
            }
            
            updateCoinCounter() {
                document.getElementById('coinCounter').textContent = this.coins;
            }
            
            updateShopButton() {
                const shopBtn = document.getElementById('shopBtn');
                if (this.shopUnlocked) {
                    shopBtn.classList.remove('locked');
                } else {
                    shopBtn.classList.add('locked');
                }
            }
            
            initShop() {
                const shopItemsContainer = document.querySelector('.shop-items');
                shopItemsContainer.innerHTML = '';
                
                // Create shop items
                this.shopItems.forEach(item => {
                    const isOwned = this.ownedSkins.includes(item.id);
                    const isSelected = this.player.skin === item.id;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = `shop-item${isOwned ? ' owned' : ''}${isSelected ? ' selected' : ''}`;
                    itemElement.dataset.id = item.id;
                    
                    const imageElement = document.createElement('div');
                    imageElement.className = 'shop-item-image';
                    imageElement.textContent = item.emoji;
                    
                    const nameElement = document.createElement('div');
                    nameElement.className = 'shop-item-name';
                    nameElement.textContent = item.name;
                    
                    const priceElement = document.createElement('div');
                    priceElement.className = 'shop-item-price';
                    priceElement.textContent = isOwned ? 'Owned' : item.price;
                    
                    itemElement.appendChild(imageElement);
                    itemElement.appendChild(nameElement);
                    itemElement.appendChild(priceElement);
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                    itemElement.addEventListener('click', () => {
                        this.selectShopItem(itemElement, item.id);
                    });
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                    itemElement.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        this.selectShopItem(itemElement, item.id);
                    }, { passive: false });
                    
                    shopItemsContainer.appendChild(itemElement);
                });
                
                // Set up buy button
                const buyButton = document.getElementById('buyButton');
                buyButton.addEventListener('click', () => {
                    this.handleBuyButton();
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                buyButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.handleBuyButton();
                }, { passive: false });
                
                // Set up close button
                const closeButton = document.getElementById('closeShopButton');
                closeButton.addEventListener('click', () => {
                    document.getElementById('shopModal').style.display = 'none';
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                closeButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    document.getElementById('shopModal').style.display = 'none';
                }, { passive: false });
            }
            
            // –í—ã–¥–µ–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
            selectShopItem(itemElement, itemId) {
                // Deselect all items
                document.querySelectorAll('.shop-item').forEach(el => {
                    el.classList.remove('selected');
                });
                
                // Select this item
                itemElement.classList.add('selected');
                
                // Update buy button state
                this.updateBuyButtonState(itemId);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏
            handleBuyButton() {
                const selectedItem = document.querySelector('.shop-item.selected');
                if (!selectedItem) return;
                
                const itemId = selectedItem.dataset.id;
                const item = this.shopItems.find(i => i.id === itemId);
                
                if (this.ownedSkins.includes(itemId)) {
                    // Already owned, just equip it
                    this.player.setSkin(itemId);
                    this.showShopMessage('Skin equipped!');
                } else if (this.coins >= item.price) {
                    // Buy the skin
                    this.coins -= item.price;
                    this.ownedSkins.push(itemId);
                    localStorage.setItem('doodleJumpCoins', this.coins);
                    localStorage.setItem('doodleJumpOwnedSkins', JSON.stringify(this.ownedSkins));
                    this.updateCoinCounter();
                    
                    // Mark as owned in UI
                    selectedItem.classList.add('owned');
                    selectedItem.querySelector('.shop-item-price').textContent = 'Owned';
                    
                    // Equip the skin
                    this.player.setSkin(itemId);
                    this.showShopMessage('Skin purchased and equipped!');
                } else {
                    // Not enough coins
                    this.showShopMessage('Not enough coins!');
                }
                
                // Update buy button state
                this.updateBuyButtonState(itemId);
            }
            
            updateBuyButtonState(itemId) {
                const buyButton = document.getElementById('buyButton');
                const item = this.shopItems.find(i => i.id === itemId);
                
                if (this.ownedSkins.includes(itemId)) {
                    buyButton.textContent = 'Equip';
                    buyButton.disabled = false;
                } else if (this.coins >= item.price) {
                    buyButton.textContent = `Buy (${item.price} coins)`;
                    buyButton.disabled = false;
                } else {
                    buyButton.textContent = `Buy (${item.price} coins)`;
                    buyButton.disabled = true;
                }
            }
            
            showShopMessage(message) {
                const messageElement = document.getElementById('shopMessage');
                messageElement.textContent = message;
                
                // Clear message after 3 seconds
                setTimeout(() => {
                    messageElement.textContent = '';
                }, 3000);
            }
            
            openShop() {
                document.getElementById('shopModal').style.display = 'flex';
                
                // Select the current skin
                document.querySelectorAll('.shop-item').forEach(item => {
                    item.classList.remove('selected');
                    if (item.dataset.id === this.player.skin) {
                        item.classList.add('selected');
                    }
                });
                
                // Update buy button state
                this.updateBuyButtonState(this.player.skin);
            }
        }

        // Initialize game
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const startScreen = document.getElementById('startScreen');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
            const shopBtn = document.getElementById('shopBtn');
            const instructions = document.getElementById('gameInstructions');
            
            let game = null;
            let gameStarted = false;

            function resizeCanvas() {
                const container = document.getElementById('gameContainer');
                if (window.innerWidth <= 768) {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    container.style.width = '100%';
                    container.style.height = '100%';
                } else {
                    canvas.width = 400;
                    canvas.height = 600;
                    container.style.width = '400px';
                    container.style.height = '600px';
                }
            }

            function startGame(e) {
                if (e) {
                    e.preventDefault();
                }
                if (!gameStarted) {
                    startScreen.style.display = 'none';
                    resizeCanvas();
                    game = new Game(canvas, ctx);
                    game.init();
                    gameLoop();
                    gameStarted = true;
                }
            }

            function gameLoop() {
                if (game) {
                    game.update();
                    game.draw();
                    requestAnimationFrame(gameLoop);
                }
            }

            function restartGame(e) {
                if (e) {
                    e.preventDefault();
                }
                restartBtn.style.display = 'none';
                game = new Game(canvas, ctx);
                game.init();
                gameStarted = true;
            }

            // Shop button handler
            shopBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (!game || !game.shopUnlocked) return;
                game.openShop();
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            shopBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                if (!game || !game.shopUnlocked) return;
                game.openShop();
            }, { passive: false });

            // Start button handlers
            startBtn.addEventListener('click', startGame);
            startBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                startGame();
            }, { passive: false });

            // Restart button handlers
            restartBtn.addEventListener('click', restartGame);
            restartBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                restartGame();
            }, { passive: false });

            // Desktop controls
            window.addEventListener('keydown', (e) => {
                if (!game) return;
                
                if (e.code === 'Space' && game.gameOver) {
                    restartGame();
                } else if (e.code === 'ArrowLeft') {
                    game.player.velocityX = -5;
                    game.hideInstructions();
                } else if (e.code === 'ArrowRight') {
                    game.player.velocityX = 5;
                    game.hideInstructions();
                }
            });

            window.addEventListener('keyup', (e) => {
                if (!game) return;
                
                if (e.code === 'ArrowLeft' && game.player.velocityX < 0) {
                    game.player.velocityX = 0;
                } else if (e.code === 'ArrowRight' && game.player.velocityX > 0) {
                    game.player.velocityX = 0;
                }
            });

            // Mobile touch controls
            const touchLeft = document.getElementById('leftTouch');
            const touchRight = document.getElementById('rightTouch');

            function handleTouchStart(direction) {
                if (!game) return;
                game.player.velocityX = direction === 'left' ? -5 : 5;
                game.hideInstructions();
            }

            function handleTouchEnd() {
                if (!game) return;
                game.player.velocityX = 0;
            }

            touchLeft.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleTouchStart('left');
            }, { passive: false });

            touchRight.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleTouchStart('right');
            }, { passive: false });

            touchLeft.addEventListener('touchend', (e) => {
                e.preventDefault();
                handleTouchEnd();
            }, { passive: false });

            touchRight.addEventListener('touchend', (e) => {
                e.preventDefault();
                handleTouchEnd();
            }, { passive: false });

            // Handle window resize
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('orientationchange', () => {
                setTimeout(resizeCanvas, 100);
            });

            // Initial setup
            resizeCanvas();
        });
    </script>
</body>
</html> 